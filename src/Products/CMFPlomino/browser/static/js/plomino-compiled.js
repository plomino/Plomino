require(["jquery","pat-base","mockup-patterns-texteditor"],function(e,t,i){"use strict";return t.extend({name:"plominoformula",parser:"mockup",trigger:".plomino-formula",defaults:{},init:function(){var t=this;t.$el.width();t.$el.hide();var n=e("<pre></pre>");n.appendTo(t.$el.parent()),t.ace=new i(n),t.ace.init(),setTimeout(function(){t.ace.editor.getSession().setMode("ace/mode/python"),n.css("width","100%"),t.ace.editor.resize(),t.ace.setText(t.$el.val()),t.ace.editor.on("change",function(){t.$el.val(t.ace.editor.getValue())})},200)}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/formula.js",function(){}),require(["jquery","pat-base"],function(e,t){"use strict";return t.extend({name:"plominotable",parser:"mockup",trigger:".plomino-table",defaults:{},init:function(){var e=this;e.init_search(),e.init_sorting(),e.refresh({}),e.params={}},refresh:function(){var t=this;if(t.options.source){t.$el.find("tr:not(.header-row)").remove();var i=t.$el.find("tr.header-row.count");i.find("td").text("Loading..."),e.get(t.options.source,t.params,function(e){for(var n="",r=0;r<e.rows.length;r++){var o=e.rows[r];if(n+="<tr>","True"!==t.options.hideCheckboxes&&(n+="<td>",n+='<input type="checkbox" name="sdoc" value="'+o[0]+'" />',n+="</td>"),n+='<td><a href="'+t.options.source+"/../document/"+o[0]+'">'+o[1]+"</a></td>",o.length>2)for(var a=2;a<o.length;a++)n+="<td>"+o[a]+"</td>";n+="</tr>"}e.rows.length>1?i.find("td").text(e.rows.length+" documents"):i.find("td").text(e.rows.length+" document"),i.before(n)})}},init_search:function(){var t=this,i=e('<input type="text" placeholder="Search"/>');t.$el.before(i),i.on("submit",function(){return!1});var n,r=!1;i.on("keyup",function(){var i=e('#plomino-view input[type="text"]').val();i.length<3&&!r||(n&&clearTimeout(n),n=setTimeout(function(){t.params.search=i,t.refresh(),r=!!i,clearTimeout(n)},1e3))})},init_sorting:function(){var t=this;t.$el.find("th").on("click",function(){t.$el.find("th").removeClass("icon-down-dir icon-up-dir");var i=e(this).attr("data-column");i==t.params.sorton?t.params.reverse=1==t.params.reverse?0:1:(t.params.sorton=i,t.params.reverse=0),0===t.params.reverse?e(this).addClass("icon-down-dir"):e(this).addClass("icon-up-dir"),t.refresh()})}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/table.js",function(){}),require(["jquery","pat-base"],function(e,t){"use strict";return t.extend({name:"plominodynamic",parser:"mockup",trigger:"#plomino_form",defaults:{},init:function(){var t=this;t.refresh(this.$el),this.$el.find(":input").change(function(e){t.refresh(e.target)}),t.hidewhen_html={},t.$el.find(".plomino-hidewhen").each(function(i,n){t.hidewhen_html[e(n).attr("data-hidewhen")]=e(n).html()})},refresh:function(t){var i=this,n=i.getCurrentInputs();i.options.docid&&(n._docid=i.options.docid),n._hidewhens=i.getHidewhens(),n._fields=i.getDynamicFields(),n._validation=t.id,(n._hidewhens.length>0||n._fields.length>0)&&e.post(i.options.url+"/dynamic_evaluation",e.param(n,!0),function(e){i.applyHidewhens(e.hidewhens),i.applyDynamicFields(e.fields)},"json")},getCurrentInputs:function(){var t,i,n,r,o,a,s={},l=e("form").serialize().split("&");for(t in l)n=(i=l[t].split("="))[0],r=decodeURIComponent(i[1].replace(/\+/g,"%20")),n in s&&(o=s[n],a=[],Array.isArray(o)||(a.push(o),o=a),o.push(r),r=o),s[n]=r;return s},getHidewhens:function(){var t=[];return this.$el.find(".plomino-hidewhen").each(function(i,n){t.push(e(n).attr("data-hidewhen"))}),t},getDynamicFields:function(){var t=[];return this.$el.find(".dynamicfield").each(function(i,n){t.push(e(n).attr("data-dynamicfield"))}),t},applyHidewhens:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i][0],r=e[i][1],o=e[i][2],a=t.$el.find('.plomino-hidewhen[data-hidewhen="'+n+'"]');r?(a.hide(),o&&(a.html(t.hidewhen_html[n]),a.find(":input").change(function(e){t.refresh(e.target)}))):a.show()}},applyDynamicFields:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i][0],r=e[i][1];t.$el.find('.dynamicfield[data-dynamicfield="'+n+'"]').text(r)}}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/dynamic.js",function(){}),require(["jquery","pat-base","mockup-patterns-modal","mockup-patterns-select2"],function(e,t,i,n){"use strict";return t.extend({name:"plominodatagrid",parser:"mockup",trigger:".plomino-datagrid",defaults:{},init:function(){var t=this;if(t.fields=t.$el.attr("data-fields").split(","),t.columns=t.$el.attr("data-columns").split(","),t.input=t.$el.find('input[type="hidden"]'),t.values=JSON.parse(t.input.val()),t.rows=JSON.parse(t.$el.find("table").attr("data-rows")),t.col_number=t.fields.length,t.associated_form=t.$el.attr("data-associated-form"),t.source_view=t.$el.attr("data-source-view"),t.$el.attr("data-form-urls"))t.form_urls=JSON.parse(t.$el.attr("data-form-urls"));else{var n=/(.*)\/(.*)\/OpenForm\?(.*)/.exec(t.$el.attr("data-form-url"))[2];t.form_urls=[{url:t.$el.attr("data-form-url"),id:n}]}var r=t.$el.find(".select2-template > .pat-select2"),o=e(r[1]);t.CustomModal=i.extend({render:function(t){var i=this;i.emit("render"),i.options.render.apply(i,[t]),i.emit("rendered"),e(this.$modalDialog.find(".plominoClose")).attr("onclick",'$(".plone-modal-close").click()')}}),o.change(function(e){if(e.added)if("NEW_DOC"==e.added.id)(function(e){new t.CustomModal(o,{ajaxUrl:t.form_urls[0].url,ajaxType:"POST",position:"middle top",actions:{"input.plominoSave":{onSuccess:t.add.bind({grid:t,formid:o.attr("data-formid")}),onError:function(){return e.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()})(window.top);else e.added.object&&t.add_from_selection(e.added.object);return o.select2("val",""),!1}),t.render()},isFieldVisible:function(e){if(this.source_view){var t=/(('_view_'|'_form_')\/)?(.*)\/(.*)/;return e.match(t)}return!0},setValue:function(e){var t=this;t.input.val(e),t.input.change()},render:function(){var t=this,i=t.$el.find(".select2-cell > .pat-select2");i.length&&(i.detach(),t.$el.find(".select2-template").append(i));for(var n=t.$el.find("table"),r="<tr><th></th>",o=0;o<t.col_number;o++){c=t.fields[o];t.isFieldVisible(c)&&(r+="<th>"+t.columns[o]+"</th>")}r+="</tr>";for(var a=0;a<t.rows.length;a++){for(var s=t.form_url,l=t.associated_form,d=0;d<t.form_urls.length;d++)if(t.form_urls[d].id==l){s=t.form_urls[d].url;break}r+='<tr><td class="actions"><a class="edit-row" href="'+(s+="&"+e.param(t.values[a]))+'" data-formid="'+l+'"><i class="icon-pencil"></i></a>',r+='<a class="remove-row" href="#"><i class="icon-cancel"></i></a>',r+='<a class="up-row" href="#"><i class="icon-up-dir"></i></a>',r+='<a class="down-row" href="#"><i class="icon-down-dir"></i></a></td>';for(o=0;o<t.col_number;o++){var c=t.fields[o];t.isFieldVisible(c)&&(r+="<td>"+(t.rows[a][o]?t.rows[a][o]:"")+"</td>")}r+="</tr>"}var u="",f=t.$el.find(".select2-template > .pat-select2");if(t.form_urls.length>1){for(u='<select class="form_select" data-pat="width:10em">',o=0;o<t.form_urls.length;o++){var p=t.form_urls[o];u+='<option value="'+p.url+'">'+p.title+"</option>"}u+="</select>"}void 0!=t.form_urls[0]&&(0==f.length?r+='<tr><td class="actions" colspan="5">'+u+'<a class="add-row" href="'+t.form_urls[0].url+'" data-formid="'+t.form_urls[0].id+'"><i class="icon-plus"></i></a></td></tr>':r+='<tr><td class="select2-cell" colspan="'+(t.col_number+1)+'" ></td></tr>'),n.html(r),f.length>0&&(f.detach(),t.$el.find(".select2-cell").append(f));var m=t.$el.find(".add-row");t.$el.find(".form_select").each(function(i,n){var r;e(n).change(function(){for(var i=e(n).val(),o=0;o<t.form_urls.length;o++)if(t.form_urls[o].url==i){r=t.form_urls[o].id;break}m.attr("href",i).attr("data-formid",r)})}),m.click(function(e){e.stopPropagation(),e.preventDefault();var i=t.$el.find(".add-row i");!function(e){new t.CustomModal(i,{ajaxUrl:m.attr("href"),ajaxType:"POST",position:"middle top",actions:{"input.plominoSave":{onSuccess:t.add.bind({grid:t,formid:m.attr("data-formid")}),onError:function(){return e.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()}(window.top)}),t.$el.find(".edit-row").each(function(i,n){var r=e(n).attr("href").split("?",2);e(n).on("click",function(o){o.preventDefault(),jQuery.ajax({url:r[0],type:"POST",data:r[1]}).done(function(r){new t.CustomModal(t.$el,{html:r,position:"middle top",actions:{"input.plominoSave":{onSuccess:t.edit.bind({grid:t,row:i,formid:e(n).attr("data-formid")}),onError:function(){return window.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()})})}),t.$el.find(".remove-row").each(function(i,n){e(n).click(function(){t.remove(t,i)})}),t.$el.find(".up-row").each(function(i,n){e(n).click(function(){t.up(t,i)})}),t.$el.find(".down-row").each(function(i,n){e(n).click(function(){t.down(t,i)})})},CustomModal:function(){return new i.extend({render:function(t){var i=this;i.emit("render"),i.options.render.apply(i,[t]),i.emit("rendered"),e(this).find(".plominoClose").attr("onclick",'$(".plone-modal-close").click()')}})},add:function(e,t,i,n,r){var o=this.grid,a=this.formid;if(!t.errors){e.hide();for(var s={},l=[],d=(r.serializeArray(),0);d<o.col_number;d++)void 0!=o.fields[d]&&o.fields[d]in t?l.push(t[o.fields[d]].rendered):l.push("");for(var c in t)s[c]=t[c].raw;s.Form=a,o.values.push(s),o.setValue(JSON.stringify(o.values)),o.rows.push(l),o.render()}return!1},add_from_selection:function(e){for(var t=this,i={},n=[],r=0;r<t.col_number;r++)void 0!=t.fields[r]&&t.fields[r]in e?n.push(e[t.fields[r]]):n.push("");for(var o in e)i[o]=e[o];t.values.push(i),t.setValue(JSON.stringify(t.values)),t.rows.push(n),t.render()},edit:function(e,t,i,n,r){var o=this.grid,a=this.row,s=this.formid;if(!t.errors){e.hide();for(var l=[],d=0;d<o.col_number;d++)void 0!=o.fields[d]&&o.fields[d]in t?l.push(t[o.fields[d]].rendered):l.push("");o.values[a].Form=s;for(var c in t)o.values[a][c]=t[c].raw;o.setValue(JSON.stringify(o.values)),o.rows[a]=l,o.render()}return!1},remove:function(e,t){return e.values.splice(t,1),e.setValue(JSON.stringify(e.values)),e.rows.splice(t,1),e.render(),!1},up:function(e,t){if(0!=t)return e.values.splice(t-1,0,e.values.splice(t,1)[0]),e.setValue(JSON.stringify(e.values)),e.rows.splice(t-1,0,e.rows.splice(t,1)[0]),e.render(),!1},down:function(e,t){if(t!=e.values.length-1)return e.values.splice(t,0,e.values.splice(t+1,1)[0]),e.setValue(JSON.stringify(e.values)),e.rows.splice(t,0,e.rows.splice(t+1,1)[0]),e.render(),!1}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/datagrid.js",function(){}),require(["jquery","pat-base"],function(e,t){"use strict";return t.extend({name:"plominomultipage",parser:"mockup",trigger:'body.template-page.portaltype-plominoform #plomino_form input[name="plomino_current_page"]',defaults:{},init:function(){var e=this.$el.parents("#plomino_form").attr("action");window.location.href=e}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/multipage.js",function(){}),require(["jquery","pat-base","mockup-patterns-modal","mockup-patterns-select2","mockup-patterns-sortable","mockup-patterns-backdrop","mockup-utils","pat-registry"],function(e,t,i,n,r,o,a,s){"use strict";return t.extend({name:"plominomacros",parser:"mockup",trigger:".plomino-macros",defaults:{},init:function(){var e=this;e.form_urls=JSON.parse(e.$el.attr("data-form-urls"));var t=[];for(var i in e.form_urls)t.push({text:i,children:e.form_urls[i].map(function(e){if(void 0!=e.title)return{id:e.id,text:e.title}})});e.select2_args={data:t,separator:"\t",multiple:!0,allowNewItems:!1,placeholder:"add a new rule",formatSelection:e.formatMacro};e.item=e.$el.find("li").last()[0].outerHTML,e.$el.prepend(""),e.ids={};var n=0;e.$el.find("input").each(function(t,i){var r=[];""!=i.value&&(r=i.value.split("\t")),void 0==r.map&&(r=[r]),r=r.map(function(t){if(""!=t){var i=JSON.parse(t);return i._macro_id_&&(e.ids[i._macro_id_]=!0),{id:t,text:""}}}),e.initInput.bind({widget:e})(i,r),n++}),e.cleanup_inputs.bind({widget:e})(),e.backdrop=new o(e.$el,{closeOnEsc:!0,closeOnClick:!1}),e.loading=a.Loading({backdrop:e.backdrop})},initInput:function(t,i){var r=this.widget;new n(e(t),r.select2_args);var o=e(t);o.select2("data",i),o.change(function(t){var i=e(t.target);if(void 0!=t.added){var n=t.added.id,o=t.added.text,a=i.select2("data");a.pop(),i.select2("data",a),r.edit_macro.bind({widget:r})(i,n,o,{},a.length)}else if(void 0!=t.removed){t.removed.id;r.cleanup_inputs.bind({widget:r})()}return!1})},cleanup_inputs:function(){var t=this.widget,i=t.$el.find(".select2-container").size();t.$el.find(".select2-container").each(function(n,o){var a=e(o),s=a.select2("data");0==s.length&&n<i-1?e(o).closest("li").remove():(e(o).find(".select2-search-choice").each(function(i,n){e(n).on("click",function(e){e.preventDefault();var n=s[i],r=JSON.parse(n.id),o=r.Form;t.edit_macro.bind({widget:t})(a,o,r.title,r,i)})}),new r(e(o).find(".select2-choices"),{selector:".select2-search-choice",drop:function(){e(o).select2("onSortEnd")}})),n==i-1&&s.length>0&&e(t.item).appendTo(t.$el).find("input").each(function(i,n){t.initInput.bind({widget:t})(e(n),[])})}),new r(t.$el,{selector:".plomino-macros-rule"})},formatMacro:function(e){if(e.text)return e.text;var t=(e=JSON.parse(e.id)).Form;if("or"==t||"and"==t||"nor"==t)return e.title;var i="do";return t.startsWith("macro_condition_")&&(i="if"),'<span class="plomino_edit_macro"><i>'+i+"</i>&nbsp;"+e.title+'<i class="icon-pencil"></i></span>'},edit_macro:function(t,n,r,o,a){var s=this.widget,l=null;for(var d in s.form_urls)s.form_urls[d].map(function(e){e.id==n&&(l=e.url)});c=o._macro_id_;if("#"!=l[0]||!s.ids[c])if(null!=l){for(var c=o._macro_id_,u=1;void 0==c||s.ids[c];)c=n+"_"+u,u++;if(o._macro_id_=c,s.ids[c]=!0,l.startsWith("#")){var f=t.select2("data");return o.title=r,o.Form=n,f.push({id:JSON.stringify(o),text:r}),t.select2("data",f),void s.cleanup_inputs.bind({widget:s})()}s.backdrop.show(),s.loading.show(!0),jQuery.ajax({url:l,type:"POST",traditional:!0,data:o}).done(function(o){s.loading.hide(),s.backdrop.hide();new i(s.$el,{html:o,position:"middle top",actions:{"input.plominoSave":{onSuccess:function(i,o,l,d,c){if(e(o).find("#validation_errors").length>0)return!1;if(o.errors)return!1;i.hide();var u=t.select2("data"),f={};return e.map(o,function(e,t){f[t]=e.raw}),f.Form=n,void 0==f.title&&(f.title=r),u[a]={id:JSON.stringify(f),text:""},t.select2("data",u),s.cleanup_inputs.bind({widget:s})(),!1},onError:function(){return window.alert(response.responseJSON.errors.join("\n")),!1}}}}).show()})}else new i(e(t),{title:"Macro not found",html:"<div>Macro not found</div>"}).show()}})}),require(["jquery","pat-base","mockup-patterns-modal"],function(e,t,i){"use strict";return t.extend({name:"plominomacropopup",parser:"mockup",trigger:".plomino-macro",defaults:{},init:function(){var t=this;e(".plominoClose",t.$modal).each(function(){this.removeAttribute("onclick")}),e("#validation_errors a").each(function(){e(this).replaceWith(function(){return e("<span>"+e(this).html()+"</span>")})}),t.render()},render:function(){e(".plominoClose",this.$modal).off("click").on("click",function(t){t.stopPropagation(),t.preventDefault(),e(t.target).trigger("destroy.plone-modal.patterns")})}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/macros.js",function(){}),require(["jquery","pat-base"],function(e,t,i){"use strict";return t.extend({name:"plominorefresh",parser:"mockup",trigger:"body.template-edit.portaltype-plominofield",defaults:{},init:function(){var t=this;e("#form-widgets-field_type").change(function(e){t.refresh(e)})},refresh:function(t){var i=e("<input>").attr("type","hidden").attr("name","update.field.type").val("1");e("form#form").append(e(i)),e("form#form").submit()}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/refresh.js",function(){}),require(["jquery","pat-base"],function(e,t){"use strict";return t.extend({name:"plominoattachment",parser:"mockup",trigger:'input[type="file"]',defaults:{},init:function(){this.$el.siblings('input[name="attachment-delete"][type="checkbox"]').css("display","none"),this.$el.siblings("a.delete-attachment").on("click",function(){e(this).siblings('a.file-attachment[data-filename="'+e(this).data("filename")+'"]').css("display","none"),e(this).siblings('input[name="attachment-delete"][data-filename="'+e(this).data("filename")+'"]').prop("checked",!0),e(this).css("display","none")})}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/attachment.js",function(){}),require(["jquery","pat-base"],function(e,t){"use strict";return t.extend({name:"plominodoclink",parser:"mockup",trigger:".plomino-doclink",defaults:{},init:function(){var t=this,i=t.$el.find('input[type="hidden"]'),n=t.$el.find(".single-select-widget"),r=e(n[1]),o=t.$el.find(".multi-select-widget"),a=e(o[1]),s=e(i[0]);if(o.length){var l=JSON.parse(o[1].dataset.list);a.select2("data",l),a.change(function(e){if(e.added){var t=e.added,i=e.val;t.id!=t.text?(n=JSON.parse(s.val())).includes(t.id)?(i.pop(),a.select2("data",l)):(n.push(t.id),l.push(t),s.val(JSON.stringify(n))):(i.pop(),a.select2("data",l))}if(e.removed){t=e.removed;l=l.filter(function(e,i,n){return e.id!=t.id}),a.select2("data",l);var n=JSON.parse(s.val()),r=n.filter(function(e,i,n){return e!=t.id});s.val(JSON.stringify(r))}})}r&&r.change(function(e){if(e.added){var t=e.added;t.id!=t.text?(r.select2("data",t),s.val(t.id)):(r.select2("val",""),s.val(""))}e.removed&&s.val("")})}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/doclink.js",function(){}),require(["jquery","pat-base"],function(e,t){"use strict";return t.extend({name:"plominoselection",parser:"mockup",trigger:".combo-selectionfield",defaults:{},init:function(){var t=this;t.$el.find(":radio, :checkbox").each(function(i,n){t.$el.find(":text").each(function(t,i){"@@OTHER_VALUE"==n.value&&n.checked?e(i).show():e(i).hide()})}),t.$el.find(":radio").change(function(i){t.$el.find(":text").each(function(t,n){"@@OTHER_VALUE"==i.target.value&&i.target.checked?e(n).show():(e(n).hide(),e(n).val(""))})}),t.$el.find(":checkbox").change(function(i){t.$el.find(":text").each(function(t,n){"@@OTHER_VALUE"==i.target.value&&(i.target.checked?e(n).show():(e(n).hide(),e(n).val("")))})})}})}),define("/Users/quang.nguyen/PlominoWorkflow/src/Products/CMFPlomino/browser/static/js/selection.js",function(){});
//# sourceMappingURL=plomino-compiled.js.map