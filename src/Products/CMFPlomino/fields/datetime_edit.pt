<tal:block tal:define="field python:options['field'];
    v python:options['fieldvalue'];
    db python:field.getParentDatabase();
    defaultformat python:db.datetime_format;
    fieldformat python:field.format;
    starting_year python:field.startingyear;
    format python:(not(fieldformat) and defaultformat) or fieldformat;
    hm python:('%H' in format or '%I' in format);
    ymd python:('%Y' in format or '%y' in format);
    mandatory python: 'mandatory' if field.mandatory else '';
    widget python:field.widget;">
    <tal:widget tal:condition="python: widget=='JQUERY'">
        <input type="text" class="pat-pickadate"
            tal:define="inputvalue python: '' if not v else v.strftime(format);"
            tal:attributes="name field/id;
                id field/id;
                data-pat-pickadate python:(('%H' in format) and '') or 'time:false';
                value inputvalue">
    </tal:widget>
    <tal:widget tal:condition="python:widget=='SERVER'">
        <tal:block tal:condition="python:v">
            <tal:define tal:define="id field/id;
                show_hm hm|nothing;
                show_ymd ymd|nothing;
                ymd_fmt python:show_ymd and '%Y-%m-%d' or '';
                hm_fmt python:show_hm and '%I:%M %p' or '';
                inputvalue python:isinstance(v, basestring) and v or v.strftime(' '.join([ymd_fmt, hm_fmt]).strip());">
                <input tal:attributes="
                    type python:(show_hm and show_ymd and 'datetime-local') or (show_hm and 'time') or (show_ymd and 'date');
                    min python: (starting_year and str(starting_year)+'-01-01') or '';
                    name field/id;
                    id field/id;
                    value inputvalue;
                    ">
            </tal:define>
        </tal:block>
        <tal:block tal:condition="python:not(v)">
            <tal:define tal:define="id field/id;
                show_hm hm|nothing;
                show_ymd ymd|nothing;">
                <input tal:attributes="
                    type python:(show_hm and show_ymd and 'datetime-local') or (show_hm and 'time') or (show_ymd and 'date');
                    min python: (starting_year and str(starting_year)+'-01-01') or '';
                    name field/id;
                    id field/id;
                    ">
            </tal:define>
        </tal:block>
    </tal:widget>
    <tal:widget tal:condition="python:widget=='COMBO'">
        <div class="combo-date" tal:attributes="id field/id">
        <tal:block tal:condition="python:v">
            <tal:define tal:define="id field/id;
                year python:v.year;
                month python:v.month;
                day python:v.day">
                <input type="number" min="0" max="31"
                    tal:attributes="
                    name string:${field/id}.day:record;
                    id string:${field/id}.day:record;
                    value day;
                    ">
                <input type="number" min="0" max="12"
                    tal:attributes="
                    name string:${field/id}.month:record;
                    id string:${field/id}.month:record;
                    value month;
                    ">
                <input type="number" min="1975" max="2050"
                    tal:attributes="
                    min python: starting_year or '';
                    name string:${field/id}.year:record;
                    id string:${field/id}.year:record;
                    value year;
                    ">
            </tal:define>
        </tal:block>
        <tal:block tal:condition="python:not(v)">
            <tal:define tal:define="id field/id;">
                <input type="number" min="0" max="31"
                    tal:attributes="
                    name string:${field/id}.day:record;
                    id string:${field/id}.day:record;
                    ">
                <input type="number" min="0" max="12"
                    tal:attributes="
                    name string:${field/id}.month:record;
                    id string:${field/id}.month:record;
                    ">
                <input type="number" min="1975" max="2050"
                    tal:attributes="
                    min python: starting_year or '';
                    name string:${field/id}.year:record;
                    id string:${field/id}.year:record;
                    ">
            </tal:define>
        </tal:block>
        </div>
    </tal:widget>
</tal:block>
