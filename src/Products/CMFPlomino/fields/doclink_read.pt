<tal:widget tal:condition="python:options['field'].widget!='DATAGRID'" >

    <tal:block tal:define="field python:options['field'];
            settings field/getSettings;
            fieldvalue python:options['fieldvalue'];
            current python:options['fieldvalue'] or [];
            lcurrent_ids python:(hasattr(current,'split') and [current]) or current;
            ">
        <tal:loop tal:repeat="v lcurrent_ids">
            <tal:link><a
                     tal:content="python:field.getSettings().getDocumentDisplay(v)"
                     tal:attributes="href python:field.getParentDatabase().getDocument(v).doc_url()">link to
                doc</a></tal:link>
            <tal:sep tal:condition="not:repeat/v/end" tal:content="structure python:field.separator">separator</tal:sep>
        </tal:loop>
    </tal:block>

</tal:widget>


<tal:widget tal:condition="python:options['field'].widget=='DATAGRID'" >

    <div  tal:define="
            field python:options['field'];
            fieldname python:field.id;
            settings field/getSettings;
            parent_form field/getParentNode;
            fieldvalue python:options['fieldvalue'];
            datagrid python:settings.getDatagrid(fieldvalue);
            fields settings/getColumns;
            columns python:fields[1];
            columns columns|python:['A','B','C'];
            fields python:fields[0];
            ">
        <table
                 tal:define="rows datagrid|nothing">
            <tr>
                <th tal:repeat="col columns"
                         tal:content="col">col
                </th>
            </tr>
            <tr tal:repeat="row rows">
                <td tal:repeat="field fields"
                         tal:content="structure python:row.get(field,'')">cell
                </td>
            </tr>
        </table>
    </div>
</tal:widget>
